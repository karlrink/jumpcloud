
aws firewall integration.

create a device group.  

any devices in that jc group get thier remote ip addr
add that ip addr to ec2 security group

#---
Notes:  i forgot how to use my own program...

üê∞ karl.rink@Karl-MacBook-Pro ~ % jumpcloud list_systemgroups
5e891821b5440602f145db29 "Appserv Systems"
5dcef82e1f2475058b432a63 "Billing Systems"
5dcef816232e110da270ddc7 "BI Systems"
5e13a87945886d6177147a0a "Build Systems"
5dcef8541f2475058b432a8e "Cebu Systems"
5dcef862232e110da270de13 "CRM Systems"
5e6ff2fa232e117821cab294 "DB Systems"
5dfc0a2445886d6808795366 "Dev Systems"
5d9e213e1f24757a1271a605 "Engineer Laptops"
5dcef8751f2475058b432aa4 "Finance Systems"
5dcef88a1f2475058b432ac5 "Founders Systems"
5dcef89a1f2475058b432ace "HR Systems"
5e6ff31f232e117821cab298 "Hypervisor Systems"
5cf93bbb1f2475279489bdc8 "IT Systems"
5e59921b232e115836375f63 "Linux Systems"
5e472b9b232e111f8de581bb "LOCAL USA CSR SYSTEMS"
5e472ba845886d66192f89ff "LOCAL USA TSR SYSTEMS"
5e59922a232e115836375f67 "Mac Systems"
5dcef8c245886d243d7d76f7 "Marketing Systems"
5ebc6e09232e117bd86e1fed "MongoDB"
5e4734551f247536ae65fdc9 "Non-Production Systems"
5dcef8d545886d243d7d76fc "PDB Systems"
5e4c5ce4232e111f8de8279b "Pre-Production Systems"
5e15314a45886d6177160dbb "Prod-Proxy Systems"
5e8cb733232e112328983261 "Production-Support Systems"
5e0fdf8d1f24753fe6804976 "Production Systems"
5dcef8e4232e110da270de76 "Product Systems"
5e04f92845886d6808803bd6 "QA Systems"
5dcef8f81f2475058b432b06 "R&D Systems"
607750861f24752fb98b5fc6 "Remote Desktop Systems AWS FW sisense"
5e472bf245886d66192f8a14 "REMOTE USA CSR SUPERVISOR SYSTEMS"
5e472839232e111f8de57e6f "REMOTE USA CSR SYSTEMS"
5e472c121f247536ae65f99e "REMOTE USA TSR SUPERVISOR SYSTEMS"
5e472b711f247536ae65f96b "REMOTE USA TSR SYSTEMS"
5dcef90745886d243d7d7721 "Software Systems"
5dcef917232e110da270de8b "Synthetic Systems"
5e0fdf6c1f24753fe6804971 "TU Systems"
5e5d64fe45886d6c2066520c "Windows Systems"
üê∞ karl.rink@Karl-MacBook-Pro ~ %

üê∞ karl.rink@Karl-MacBook-Pro ~ % jumpcloud list_systemgroups_membership 607750861f24752fb98b5fc6
5dded15570469272b8e81b2b DESKTOP-245CO5K
5e30c0b9890a7a4766268b59 Karl-MacBook-Pro.local
üê∞ karl.rink@Karl-MacBook-Pro ~ %


üê∞ karl.rink@Karl-MacBook-Pro ~ % jumpcloud get_systems_json 5dded15570469272b8e81b2b
{
    "_id": "5dded15570469272b8e81b2b",
    "active": true,
    "agentVersion": "0.144.0",
    "allowMultiFactorAuthentication": false,
    "allowPublicKeyAuthentication": false,
    "allowSshPasswordAuthentication": false,
    "allowSshRootLogin": false,
    "arch": "64-bit",
    "builtInCommands": [
        {
            "name": "erase",
            "type": "security"
        },
        {
            "name": "lock",
            "type": "security"
        },
        {
            "name": "restart",
            "type": "security"
        },
        {
            "name": "shutdown",
            "type": "security"
        }
    ],
    "connectionHistory": [],
    "created": "2019-11-27T19:41:09.000Z",
    "displayName": "DESKTOP-245CO5K Deb Cockrum",
    "fde": {
        "active": true,
        "keyPresent": true
    },
    "fileSystem": null,
    "hasServiceAccount": false,
    "hostname": "DESKTOP-245CO5K",
    "id": "5dded15570469272b8e81b2b",
    "lastContact": "2021-04-14T21:48:36.000Z",
    "mdm": {
        "dep": false,
        "profileIdentifier": "",
        "userApproved": false,
        "vendor": "unknown"
    },
    "modifySSHDConfig": false,
    "networkInterfaces": [
        {
            "address": "172.20.5.19",
            "family": "IPv4",
            "internal": false,
            "name": "Local Area Connection"
        },
        {
            "address": "",
            "family": "IPv6",
            "internal": false,
            "name": "Local Area Connection"
        },
        {
            "address": "172.18.2.8",
            "family": "IPv4",
            "internal": false,
            "name": "Local Area Connection 2"
        },
        {
            "address": "",
            "family": "IPv6",
            "internal": false,
            "name": "Local Area Connection 2"
        },
        {
            "address": "2600:1010:b028:3433:5c42:71e1:cae1:a0f0",
            "family": "IPv6",
            "internal": false,
            "name": "Ethernet"
        },
        {
            "address": "2600:1010:b028:3433:cdc4:1dc7:d795:3e3",
            "family": "IPv6",
            "internal": false,
            "name": "Ethernet"
        },
        {
            "address": "192.168.1.3",
            "family": "IPv4",
            "internal": false,
            "name": "Ethernet"
        }
    ],
    "organization": "5cdc7f3c95a60d5c14488d5f",
    "os": "Windows",
    "remoteIP": "174.194.134.239",
    "serialNumber": "FKJ44F2",
    "sshRootEnabled": true,
    "sshdParams": [],
    "systemInsights": {
        "state": "enabled"
    },
    "systemTimezone": -7,
    "systemToken": "9a17b642-634f-f75e-0d00-b1e76b8ed1a0",
    "templateName": "windows-windows-x86_64",
    "version": "10 Pro"
}
üê∞ karl.rink@Karl-MacBook-Pro ~ %

need this to work:

üê∞ karl.rink@Karl-MacBook-Pro ~ % jumpcloud get_systems_remoteIP 5dded15570469272b8e81b2b
KeyError: 'get_systems_remoteIP'


#---

# aws ec2 authorize-security-group-ingress --group-id sg-0347e06ea035f9e86 --protocol tcp --port 3389 --cidr 192.168.99.99/32


############

nice!


üê∞ karl.rink@Karl-MacBook-Pro ~ % jumpcloud get_systems_remoteIP 5dded15570469272b8e81b2b
174.194.134.239


#########################################################################################################################################3


need this to work...

üê∞ karl.rink@Karl-MacBook-Pro jumpcloud % jumpcloud add_systems_remoteIP_to_awsSG 5e30c0b9890a7a4766268b59 sg-0347e06ea035f9e86
KeyError: 'add_systems_remoteIP_to_awsSG'


for now we'll just hardcode --port 3389
really just need to re-write cli args that are currently limited.  perhaps re-visit argspars or getops...




ok, this is working now...

üê∞ karl.rink@Karl-MacBook-Pro ~ % jumpcloud add_systems_remoteIP_awsSG 5e30c0b9890a7a4766268b59 sg-0347e06ea035f9e86
172.251.165.173
sg-0347e06ea035f9e86


An error occurred (InvalidPermission.Duplicate) when calling the AuthorizeSecurityGroupIngress operation: the specified rule "peer: 172.251.165.173/32, TCP, from port: 3389, to port: 3389, ALLOW" already exists

üê∞ karl.rink@Karl-MacBook-Pro ~ %



######################


testing how long it takes to update...

curl http://checkip.amazonaws.com/
172.251.165.173

üê∞ karl.rink@Karl-MacBook-Pro ~ % jumpcloud get_systems_remoteIP 5e30c0b9890a7a4766268b59
107.77.227.212


